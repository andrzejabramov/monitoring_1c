services:
  # ============================================================================
  # üîµ PostgreSQL –¥–ª—è –ª–æ–≥–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –±–∏–ª–ª–∏–Ω–≥–∞ (MVP)
  # ============================================================================
  monitoring-db:
    image: postgres:15-alpine
    container_name: onec-monitoring-db
    restart: unless-stopped

    # –ü–æ—Ä—Ç 5433 –Ω–∞ —Ö–æ—Å—Ç–µ ‚Üí 5432 –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    ports:
      - "${DB_HOST_PORT:-5433}:5432"

    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
    environment:
      - POSTGRES_DB=${DB_NAME:-onec_monitoring}
      - POSTGRES_USER=${DB_USER:-monitor}
      - POSTGRES_PASSWORD=${DB_PASSWORD:-change_me_in_production}

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
    volumes:
      # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
      - ./database/init:/docker-entrypoint-initdb.d:ro
      # –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
      - ./database/pgdata:/var/lib/postgresql/data

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ë–î
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "pg_isready -U ${DB_USER:-monitor} -d ${DB_NAME:-onec_monitoring}",
        ]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

    # –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ç—å
    networks:
      - monitoring-network

# –°–µ—Ç—å –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
networks:
  monitoring-network:
    driver: bridge
